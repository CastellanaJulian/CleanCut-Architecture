<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva tu Turno - CleanCut</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div class="container mt-5">
        <div class="card shadow-sm" style="max-width: 500px; margin: auto;">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üíà Nuevo Turno</h4>
            </div>
            <div class="card-body">
                <form id="turnoForm">

                    <div class="mb-3">
                        <label class="form-label">Cliente</label>
                        <input type="text" id="cliente" class="form-control" placeholder="Nombre del cliente" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Fecha y Hora</label>
                        <input type="datetime-local" id="fecha" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Servicio</label>
                        <select id="servicio" class="form-select">
                            <option value="Corte Clasico">Corte Cl√°sico</option>
                            <option value="Barba">Barba</option>
                            <option value="Completo">Completo (Corte + Barba)</option>
                        </select>
                    </div>

                    <input type="hidden" id="peluquero_id" value="peluquero_01">

                    <button type="submit" class="btn btn-success w-100">Reservar Turno</button>
                </form>

                <div id="mensaje" class="mt-3 alert d-none"></div>
            </div>
        </div>
    </div>

    <script>
        // IMPORTANTE: Esta URL cambiar√° cuando levantemos la infraestructura con Terraform
        const API_URL = "http://localhost:4566/restapis/amg90xdsny/dev/_user_request_/turnos";

        document.getElementById('turnoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const datos = {
                peluquero_id: document.getElementById('peluquero_id').value,
                fecha_hora: document.getElementById('fecha').value,
                cliente: document.getElementById('cliente').value,
                servicio: document.getElementById('servicio').value
            };

            const mensajeDiv = document.getElementById('mensaje');

            try {
                // Nota: Al usar fetch directo, si no configuramos CORS en AWS, esto fallar√°.
                // Lo arreglaremos en el paso de Terraform.
                const respuesta = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });

                const resultado = await respuesta.json();

                if (respuesta.ok) {
                    mensajeDiv.className = 'mt-3 alert alert-success';
                    mensajeDiv.innerText = '‚úÖ Turno reservado: ' + JSON.stringify(resultado);
                } else {
                    throw new Error(resultado.error || 'Error desconocido');
                }
            } catch (error) {
                mensajeDiv.className = 'mt-3 alert alert-danger';
                mensajeDiv.innerText = '‚ùå Error de conexi√≥n: ' + error.message;
            }
            mensajeDiv.classList.remove('d-none');
        });
    </script>

</body>

</html>