<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva tu Turno - CleanCut</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="config.js"></script> <!-- Debe cargarse antes del script que usa API_URL -->
</head>

<body class="bg-light">

    <div class="container mt-5">
        <div class="card shadow-sm" style="max-width: 500px; margin: auto;">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üíà Nuevo Turno</h4>
            </div>
            <div class="card-body">
                <form id="turnoForm">
                    <!-- Nuevo: sucursal_id (puede venir de config.js si lo defin√≠s como window.SUCURSAL_ID) -->
                    <input type="hidden" id="sucursal_id" value="">
                    <script>
                        // Si config.js define window.SUCURSAL_ID, lo inyectamos en el hidden
                        document.addEventListener('DOMContentLoaded', () => {
                            const sucursalHidden = document.getElementById('sucursal_id');
                            if (window.SUCURSAL_ID) sucursalHidden.value = window.SUCURSAL_ID;
                        });
                    </script>

                    <div class="mb-3">
                        <label class="form-label">Cliente</label>
                        <input type="text" id="cliente" class="form-control" placeholder="Nombre del cliente" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Fecha y Hora</label>
                        <input type="datetime-local" id="fecha" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Servicio</label>
                        <select id="servicio" class="form-select">
                            <option value="Corte Clasico">Corte Cl√°sico</option>
                            <option value="Barba">Barba</option>
                            <option value="Completo">Completo (Corte + Barba)</option>
                        </select>
                    </div>

                    <!-- Consistente con staff -->
                    <input type="hidden" id="staff_id" value="staff_01">

                    <button type="submit" class="btn btn-success w-100">Reservar Turno</button>
                </form>

                <div id="mensaje" class="mt-3 alert d-none"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const apiUrl = window.API_URL;
            const form = document.getElementById('turnoForm');
            const mensajeDiv = document.getElementById('mensaje');

            if (!apiUrl) {
                mensajeDiv.className = 'mt-3 alert alert-warning';
                mensajeDiv.textContent = 'API_URL no est√° definido (config.js no cargado).';
                mensajeDiv.classList.remove('d-none');
                return;
            }

            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const datos = {
                    sucursal_id: document.getElementById('sucursal_id').value,
                    cliente_id: document.getElementById('cliente').value,          // en real deber√≠a ser el ID del cliente
                    staff_id: document.getElementById('staff_id').value,
                    servicio_id: document.getElementById('servicio').value,        // en real deber√≠a ser el ID del servicio
                    fecha_hora_inicio: document.getElementById('fecha').value
                };

                try {
                    const respuesta = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(datos)
                    });
                    const resultado = await respuesta.json();

                    if (respuesta.ok) {
                        mensajeDiv.className = 'mt-3 alert alert-success';
                        mensajeDiv.textContent = 'Turno reservado: ' + JSON.stringify(resultado);
                    } else {
                        mensajeDiv.className = 'mt-3 alert alert-danger';
                        mensajeDiv.textContent = (resultado.error || 'Error') + ' ' + JSON.stringify(resultado.details || {});
                    }
                } catch (error) {
                    mensajeDiv.className = 'mt-3 alert alert-danger';
                    mensajeDiv.textContent = 'Error de conexi√≥n: ' + error.message;
                }
                mensajeDiv.classList.remove('d-none');
            });
        });
    </script>
</body>

</html>